package mySqlDb;

import java.sql.Connection;
import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import book.Book;

public class DBActivities {

	SQLConnection sqlConn;
	Connection conn;
	public DBActivities() {
		// TODO Auto-generated constructor stub
		sqlConn=new SQLConnection();
		conn = sqlConn.getConnection();
	}

	public boolean AddToDB(int code,String title,String author,int page, boolean hasread,String userid) {
		try {

			System.out.println(code+title+author+" "+page+" "+hasread+" "+userid);
			CallableStatement callableStatement = null;
			String strProcName = "{call PROC_InsertBookDetails(?,?,?,?,?,?)}";
			callableStatement = conn.prepareCall(strProcName);
			callableStatement.setInt(1, code);
			callableStatement.setString(2, title);
			callableStatement.setString(3, author);
			callableStatement.setInt(4, page);
			callableStatement.setBoolean(5, hasread);
			callableStatement.setString(6, userid);
			callableStatement.execute();
			conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return false;
		}
		return true;
	}

	public Book ViewFromDB(String code,String userid) {
		Book bkEntity = null;

		try {
			Statement st = conn.createStatement();
			ResultSet rs = st.executeQuery("select * from TblBookDetails TB left join TblUserBookDetail TU on TB.Barcode = TU.Barcode where TB.Barcode = '"+code+"' and TU.UserDetail = '"+userid+"';");
System.out.print(code+" "userid);
			while(rs.next())
			{
				bkEntity = new Book(rs.getString("Barcode"),
						rs.getString("Title"),
						rs.getString("Author"),
						Integer.valueOf(rs.getString("No_Of_Page")),
						rs.getString("UserDetail"),
						Boolean.valueOf(rs.getString("HasRead")));
			}

			conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return bkEntity;
	}
}
